<!-- Music player page-->
<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="../css/player.css">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous"><!--css file-->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script><!--this line and the above is for bootstrap and popper-->
		<script src="https://kit.fontawesome.com/cf0c20577d.js" crossorigin="anonymous"></script> <!--Font awsesome, for ease access to icons-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<!--<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-solid-straight/css/uicons-solid-straight.css'> <!--Flaticon solid straight pack-->
		<link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
	</head>
	<body style="background-color:var(--bg-color);transition: background-color 0.4s ease-in-out">
		<div class="overlay fixed-top container-fluid">
			<div class="signup " id="signupoverlay">
				<h1 style="margin:5px;margin-left:auto;margin-right:auto">Log In</h1>
				<label for="usernamelogin" style="margin-left:10%" class="col-4">Username:</label>
				<input type="text" placeholder="username" id="usernamelogin" class="col" style="max-height:30px;margin-left:10%;width:80%;border-radius:5px">
				<label for="passwordlogin" style="margin-left:10%" class="col-4">Password:</label>
				<input type="password" placeholder="password" id="passwordlogin" class="col" style="max-height:30px;margin-left:10%;width:80%;border-radius:5px">
				<div class="d-flex" style="width:100%;justify-content:space-around">
					<button class="btn btn-primary mx-auto" id="signup1" style="margin-top:20px;min-width:30%;background-color:var(--button-color);border:none !important;">Sign Up</button>
					<button class="btn btn-primary mx-auto" id="login1" style="margin-top:20px;min-width:30%;background-color:var(--button-color);border:none !important;">Log In</button>
				</div>
			</div>
			<div class="signup " id="regoverlay">
				<h1 style="margin:5px;margin-left:auto;margin-right:auto">Register</h1>
				<label for="usernamelogin" style="margin-left:10%" class="col-4">Name:</label>
				<input type="text" placeholder="username" id="namelogin" class="col" style="max-height:30px;margin-left:10%;width:80%;border-radius:5px">
				<label for="usernamelogin" style="margin-left:10%" class="col-4">Username:</label>
				<input type="text" placeholder="username" id="usernamelogin" class="col" style="max-height:30px;margin-left:10%;width:80%;border-radius:5px">
				<label for="passwordlogin" style="margin-left:10%" class="col-4">Password:</label>
				<input type="password" placeholder="password" id="passwordlogin" class="col" style="max-height:30px;margin-left:10%;width:80%;border-radius:5px">
				<label for="passwordlogin" style="margin-left:10%" class="col-4">Confirm Password:</label>
				<input type="password" placeholder="password" id="passwordlogin" class="col" style="max-height:30px;margin-left:10%;width:80%;border-radius:5px">
				<div class="d-flex" style="width:100%;justify-content:space-around; flex-wrap: wrap">
					<button class="btn btn-primary mx-auto col-12" id="signup2" style="margin-top:20px;min-width:30%;background-color:var(--button-color);border:none !important;">Sign Up</button>
					<button class="btn btn-primary mx-auto col-12" id="login2" style="margin-top:20px;min-width:30%;background-color:var(--button-color);border:none !important;">Log In</button>
				</div>
			</div>
		</div>

		<div class="container-fluid sticky-top" style="max-height:100px;box-shadow: 0px 1px 2px dimgray; background-color:var(--nav-color); transition: background-color 0.4s ease-in-out">
			<div class="container-xxl topNav sticky-top" id="topNav">
				<div class="row" style="padding:0px 8px">
					<div class="dropdown col-sm-1 d-inline-flex px-0">
						<button class="col topNavElement" data-bs-toggle="dropdown" data-bs-auto-close="outside" id="dropdown0" aria-expanded="false">
							<!-- bars -->
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="30px" width="30px" style="fill:var(--text-color)" class="transformsvg">
								<path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7
									0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg>							
						</button>
						<ul class="dropdownmenu dropdown-menu" style="padding:0px;min-width: 5rem !important" id="dropdownmenu0">
							<li><a class="dropdown-item" href="../index.html">Home</a></li>
							<li><a class="dropdown-item" href="#">About</a></li>
							<li><a class="dropdown-item" href="#">Contact</a></li>
							<li class="row" style="width:100%;padding-top:5px; margin:0px 0px; padding-left:1px; padding-right:1px">
								<!--moon/dark theme icon-->
								<svg class="col-3 mx-1 p-0 d-inline-flex" xmlns="http://www.w3.org/2000/svg" id="moon1" data-name="Layer 1" viewBox="0 0 24 24" width="24px" height="24px">
									<path d="M14,24A12.013,12.013,0,0,1,2,12C1.847,3.044,12.031-2.985,19.791,1.509l1.553.862-1.543.88c-6.7,
									3.688-6.21,13.87.8,16.906l1.621.731-1.467,1.006A11.921,11.921,0,0,1,14,24Z"/>
								</svg>
								<span class="switch col-6 d-inline-flex px-0 mx-1" id="theme-slider" style="align-items:center;margin-left:18px;cursor:pointer">
									<input type="checkbox" style="display:none">
									<span class="slider"></span>
								</span>
							</li>
						</ul>
					</div>
					<div class="col-sm-1 d-inline-flex" style="justify-items:center;justify-content:center">
						<img src="Mesic.png" alt="Mesic logo" style="width:50px; height:50px">
					</div>
					<button class="col-sm-2 col-xs topNavElement d-inline-flex underline-animation" id="Adsearch">
						<span>Advanced Search</span>
					</button>
					<div class="col-sm-4 d-inline-flex" style="height:50px">
						<input class="searchbox col" type="text" name="" placeholder="Enter song's name">
						<div class="col-2 d-inline-flex" style="align-items: center">
							<button class="topNavElement d-inline-flex topNavSearch mx-1">
								<!-- search icon -->
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="20px" width="20px" style="fill:var(--text-color)" class="transformsvg">
									<!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
									<path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0
									 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg>
							</button>
						</div>
					</div>
					<button class="col-sm-2 topNavElement" style="border-radius:20px" id="LogResButton">
						Sign In
					</button>
				</div>
			</div>
		</div>

		<div class="container-xl" style="margin-top: 10px;background-color:var(--nav-color);color:var(--text-color);border-radius:30px">
			<div class="row d-flex">
				<h1 class="col-12 d-flex" style="justify-content: center;" id="track_name">Song Name</h1>
				<h3 class="col-12 d-flex" style="justify-content:center" id="track_artist">Artist1</h3>

			</div>
			<div class="row d-flex p-0" >
				<div class="p-0 mt-4" style="width:200px;height:200px;position:relative;left:calc(50% - 100px);border-radius:50%;box-shadow: 0 0 0 10px var(--active-search-color)">
					<img class="disk"src="music-notes.png" id="track_art">
				</div>
				
				<div class="temp p-0 mt-4"></div>
			</div>
			<div class="row d-flex p-0 mt-4" style="justify-content:center">
				<div class="current-time col-1 d-flex mx-2" id="current_time" style="justify-content:flex-end">00:00</div>
				<input type="range" value="0" class="d-flex seek-bar col-4 p-0" id="seek_slider" onchange="seekTo()">
				<div class="total-time col-1 d-flex mx-2" id="total_duration" style="justify-content:flex-start">00:00</div>
			</div>
			<div class="row d-flex p-0 mt-4" style="justify-content:center">
				<div class="d-flex col-2 p-0 mx-3 volume-control" style="align-items:center;justify-content:center">
					<img src="volume-down.png" style="height:20px;width:20px;filter:invert(var(--button-invert-val))">
					<input type="range" min="1" max="100" value="100" id="volume_slider" class="mx-2 col-12" onchange="setVolume()">
					<img src="volume-up.png" style="height:20px;width:20px;filter:invert(var(--button-invert-val))">
				</div>
			</div>
			<div class="row d-flex p-0 mt-4" style="justify-content:center">
				<div class="shuffle col-1 d-flex mx-2" style="justify-content:center">
					<img src="loop.png" id="toggleshuffleloop" style="cursor:pointer;height:30px;width:30px;filter:invert(var(--button-invert-val))" onclick="toggleshuffleloop()">
				</div>
				<div class="previous col-1 d-flex mx-2" style="justify-content:center" >
					<img src="previous.png" id="prev-track" style="cursor:pointer;height:30px;width:30px;filter:invert(var(--button-invert-val))" onclick="previous()">				
				</div>
				<div class="play col-1 d-flex mx-2" style="justify-content:center" >
					<img src="play.png" id="playpause-track" style="cursor:pointer;height:30px;width:30px;filter:invert(var(--button-invert-val))" onclick="playpause()">
				</div>
				<div class="next col-1 d-flex mx-2" style="justify-content:center" >
					<img src="next.png" id="next-track" style="cursor:pointer;height:30px;width:30px;filter:invert(var(--button-invert-val))" onclick="next()">
				</div>
				<div class="like col-1 d-flex mx-2" style="justify-content:center" >
					<img src="like.png" id="like" style="cursor:pointer;height:30px;width:30px" onclick="likesong()">
				</div>
			</div>
			<div class="p-0 mt-4 mb-4 d-flex wave" style="height:100px;justify-content:center;align-items:center;margin: 0px 20%">
				<span class="stroke"></span>
				<span class="stroke"></span>
				<span class="stroke"></span>
				<span class="stroke"></span>
				<span class="stroke"></span>
				<span class="stroke"></span>
				<span class="stroke"></span>
			</div>
		</div>
         <!--Place holder, for future contents-->
		<!--using jquery, for now-->
		<script>
			$(document).ready(function(){
				document.documentElement.setAttribute('data-theme', 'light');
				if(document.documentElement.getAttribute('data-theme') == 'light')
				{
					
				}
			});
			
			
			$('#Adsearch').click(function()
			{
				window.location.href="advancedsearch.html";
			});
			$("#dropdown0").on("show.bs.dropdown",function()
			{
				$("#dropdownmenu0").css("z-indent","5");
				$("#dropdownmenu0").css("display","flex");
				$('#dropdown0').animate({marginBottom:"+=200px"});
				$("#dropdownmenu0").animate({height:"200px",opacity:"1"},400);
			});
			$("#dropdown0").on("hide.bs.dropdown",function()
			{
				$('#dropdown0').animate({marginBottom:"-=200px"});
				$("#dropdownmenu0").animate({height:"0px",opacity:"0"},400,function()
				{
					$("#dropdownmenu0").css("display","none");
				});
				$("#dropdownmenu0").css("z-indent","0");
			});
			$("#dropdown1").on("show.bs.dropdown",function()
			{
				$("#dropdownmenu1").css("z-indent","5");
				$("#dropdownmenu1").css("display","flex");
				$("#dropdownmenu1").animate({height:"200px",opacity:"1"},400);
			});
			$("#dropdown1").on("hide.bs.dropdown",function()
			{
				$("#dropdownmenu1").animate({height:"0px",opacity:"0"},400,function()
				{
					$("#dropdownmenu1").css("display","none");
				});
				$("#dropdownmenu1").css("z-indent","0");
			});
			
			$('#LogResButton').click(function()
			{
				$('.overlay').css("display","flex");
				$('.overlay').animate({opacity:"1"},400);
				$('#signupoverlay').css("display","flex");
				$('#signupoverlay').animate({marginTop:"+8%",opacity:"1"},400);
			});
			$('.signup').click(function(event)
			{
				event.stopPropagation();
			});
			$('.overlay').click(function() //click on greyed-out area besides the login/reg form
			{
				let overlayvar=$('.overlay');
				$('.signup').animate({marginTop:"0",opacity:"0"},400,function()
				{
					$('.signup').css("display","none");
					overlayvar.animate({opacity:"0"},200);
					overlayvar.promise().done(function()
					{
						overlayvar.css("display","none");
					});
				});
			});
			$('#theme-slider').click(function()
			{
				if(document.documentElement.getAttribute('data-theme') == 'light'){
					document.documentElement.setAttribute('data-theme', 'dark');
					let temp=$('#theme-slider').width()-21;
					$('.slider').animate({left:temp},400);
				}
				else{
					document.documentElement.setAttribute('data-theme', 'light');
					$('.slider').animate({left:"1px"},400);
				}
			});
			$('#signup1').click(function() //user clicks on sign up button on the login form
			{
				$('#signupoverlay').animate({marginTop:"0",opacity:"0"},400,function()
				{
					$('#signupoverlay').css("display","none");
					$('#regoverlay').css("display","flex");
					$('#regoverlay').animate({marginTop:"+8%",opacity:"1"},400);
				});
			});
			$('#login2').click(function() //user clicks on login button on the register form
			{
				$('#regoverlay').animate({marginTop:"0",opacity:"0"},400);
				$('#regoverlay').promise().done(function()
				{
					$('#regoverlay').css("display","none");
					$('#signupoverlay').css("display","flex");
					$('#signupoverlay').animate({marginTop:"+8%",opacity:"1"},400);
				});
			});
		let track_art=document.getElementById("track_art");
		$("#track_art").css('animation-play-state','paused');
		let track_name=document.getElementById("track_name");
		let track_artist=document.getElementById("track_artist");

		let playpause_btn=document.getElementById("playpause-track");
		let next_btn=document.getElementById("next-track");
		let prev_btn=document.getElementById("prev-track");

		let seek_slider=document.getElementById("seek_slider");
		let volume_slider=document.getElementById("volume_slider");
		let curr_time=document.getElementById("current_time");
		let total_duration=document.getElementById("total_duration");
		let wave= document.querySelector('.wave');
		let like_btn=document.getElementById("like");
		
		let track_index=0;
		let isPlaying=false;
		let isLiked=false;
		let isRandom=0; //0 is loop whole collection, 1 is random, 2 is repeat 1 song
		let updateTimer;
		
		let track_queue=[];
		let curr_track=document.createElement('audio');
		$('.stroke').each(function(){
			$(this).css('animation-play-state','paused');
		})
		//get song from database
		const music_list= [
		{
			img:'Take Over.jpg',
			name:'Take Over',
			artist:'Artist 1',
			src:'Take Over.mp3'
		},
		{
			img:'Last Surprise.jpg',
			name:'Last Surprise',
			artist:'Artist 2',
			src:'Last Surprise.mp3'
		}
		];
		loadtrack(track_index);
		function loadtrack(track_index)
		{
			clearInterval(updateTimer);
			reset();
			curr_track.src=music_list[track_index].src;
			curr_track.load();
			if(track_queue.length<20)
			{
				track_queue.push(track_index);
			}
			else
			{
				track_queue.shift();
				track_queue.push(track_index);
			}
			track_art.src=music_list[track_index].img;
			track_name.textContent=music_list[track_index].name;
			track_artist.textContent=music_list[track_index].artist;
			updateTimer=setInterval(setUpdate,1000);
			curr_track.addEventListener("ended",next);
			random_bg_color();
		}
		function random_bg_color(){
			let hex = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e'];
			let a;
		
			function populate(a){
				for(let i=0; i<6; i++){
					let x = Math.round(Math.random() * 14);
					let y = hex[x];
					a += y;
				}
				return a;
			}
			let Color1 = populate('#');
			let Color2 = populate('#');
			var angle = 'to right';
		
			let gradient = 'linear-gradient(' + angle + ',' + Color1 + ', ' + Color2 + ")";
			document.body.style.background = gradient;
		}
		function reset()
		{
			curr_time.textContent="00:00";
			total_duration.textContent="00:00";
			seek_slider.value=0;
		}
		function toggleshuffleloop()
		{
			if(isRandom<2)
			{
				isRandom+=1;
			}
			else
			{
				isRandom=0;
			}
			if (isRandom==0)
			{
				playloop();
			}
			else if (isRandom==1)
			{
				playRandom();
			}
			else
			{
				playrepeat();
			}
		}
		function playloop()
		{
			console.log("play loop");
			$('#toggleshuffleloop').attr("src","loop.png")
		}
		function playRandom()
		{
			console.log("play random");
			$('#toggleshuffleloop').attr("src","shuffle.png")
		}
		function playrepeat()
		{
			console.log("pause repeat");
			$('#toggleshuffleloop').attr("src","repeat.png")
		}
		isLiked=false;
		function likesong()
		{
			isLiked ? unlike():like();
		}
		function like()
		{
			console.log("like");
			isLiked=true;
			$('#like').attr("src","liked.png")
		}
		function unlike()
		{
			console.log("unlike");
			isLiked=false;
			$('#like').attr("src","like.png")
		}
		isPlaying = false;
		function playpause()
		{
			isPlaying? pause():playTrack();
		}
		function playTrack()
		{
			console.log("play");
			isPlaying=true;
			curr_track.play();
			playpause_btn.src="pause.png";
			$('.stroke').each(function(){
				$(this).css('animation-play-state','running');
			})
			$("#track_art").css("animation-play-state","running");
		}
		function pause()
		{
			console.log("pause");
			isPlaying=false;
			curr_track.pause();
			playpause_btn.src="play.png";
			$('.stroke').each(function(){
				$(this).css('animation-play-state','paused');
			})
			$("#track_art").css("animation-play-state","paused");
		}
		function next()
		{
			if (track_index<music_list.length-1 && isRandom==0)
			{
				track_index+=1;
			}
			else if (track_index<music_list.length && isRandom==1)
			{
				let randnum=Number.parseInt(Math.random()*music_list.length);
				console.log(randnum);
				track_index=randnum;
			}
			else if (track_index<music_list.length-1 && isRandom==2)
			{
				loadtrack(track_index);
				playTrack();
			}
			else
			{
				track_index=0;
			}
			loadtrack(track_index);
			playTrack();
			if(track_queue.length<20)
			{
				track_queue.push(track_index);
			}
			else
			{
				track_queue.shift();
				track_queue.push(track_index);
			}
		}
		function previous()
		{
			/*if(track_index>0)
			{
				track_index-=1;
			}
			else
			{
				track_index=music_list.length-1;
			}
			loadtrack(track_index);
			playTrack();*/
			if(track_queue.length>0)
			{
				track_index=track_queue.pop();
				loadtrack(track_index);
				playTrack();
			}
			else
			{
				track_index=0;
				loadtrack(track_index);
				playTrack();
			}
		}
		function seekTo()
		{
			let seekto=curr_track.duration*(seek_slider.value/100);
			curr_track.currentTime=seekto;
		}
		function setVolume()
		{
			curr_track.volume=volume_slider.value/100;
		}
		function setUpdate()
		{
			let seekPosition=0;
			if(!isNaN(curr_track.duration))
			{
				seekPosition = curr_track.currentTime * (100 / curr_track.duration);
				seek_slider.value = seekPosition;
		
				let currentMinutes = Math.floor(curr_track.currentTime / 60);
				let currentSeconds = Math.floor(curr_track.currentTime - currentMinutes * 60);
				let durationMinutes = Math.floor(curr_track.duration / 60);
				let durationSeconds = Math.floor(curr_track.duration - durationMinutes * 60);
		
				if(currentSeconds < 10) {currentSeconds = "0" + currentSeconds; }
				if(durationSeconds < 10) { durationSeconds = "0" + durationSeconds; }
				if(currentMinutes < 10) {currentMinutes = "0" + currentMinutes; }
				if(durationMinutes < 10) { durationMinutes = "0" + durationMinutes; }
		
				curr_time.textContent = currentMinutes + ":" + currentSeconds;
				total_duration.textContent = durationMinutes + ":" + durationSeconds;
			}
		}
		</script>
	</body>
</html>